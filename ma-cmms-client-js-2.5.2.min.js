var FiixCmmsClient_CryptoJS=FiixCmmsClient_CryptoJS||function(a,b){var c={},d=c.lib={},e=function(){},f=d.Base={extend:function(a){e.prototype=this;var b=new e;return a&&b.mixIn(a),b.hasOwnProperty("init")||(b.init=function(){b.$super.init.apply(this,arguments)}),b.init.prototype=b,b.$super=this,b},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},g=d.WordArray=f.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=b?c:4*a.length},toString:function(a){return(a||i).stringify(this)},concat:function(a){var b=this.words,c=a.words,d=this.sigBytes;if(a=a.sigBytes,this.clamp(),d%4)for(var e=0;e<a;e++)b[d+e>>>2]|=(c[e>>>2]>>>24-8*(e%4)&255)<<24-8*((d+e)%4);else if(65535<c.length)for(e=0;e<a;e+=4)b[d+e>>>2]=c[e>>>2];else b.push.apply(b,c);return this.sigBytes+=a,this},clamp:function(){var b=this.words,c=this.sigBytes;b[c>>>2]&=4294967295<<32-8*(c%4),b.length=a.ceil(c/4)},clone:function(){var a=f.clone.call(this);return a.words=this.words.slice(0),a},random:function(b){for(var c=[],d=0;d<b;d+=4)c.push(4294967296*a.random()|0);return new g.init(c,b)}}),h=c.enc={},i=h.Hex={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++){var e=b[d>>>2]>>>24-8*(d%4)&255;c.push((e>>>4).toString(16)),c.push((15&e).toString(16))}return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d+=2)c[d>>>3]|=parseInt(a.substr(d,2),16)<<24-4*(d%8);return new g.init(c,b/2)}},j=h.Latin1={stringify:function(a){var b=a.words;a=a.sigBytes;for(var c=[],d=0;d<a;d++)c.push(String.fromCharCode(b[d>>>2]>>>24-8*(d%4)&255));return c.join("")},parse:function(a){for(var b=a.length,c=[],d=0;d<b;d++)c[d>>>2]|=(255&a.charCodeAt(d))<<24-8*(d%4);return new g.init(c,b)}},k=h.Utf8={stringify:function(a){try{return decodeURIComponent(escape(j.stringify(a)))}catch(a){throw Error("Malformed UTF-8 data")}},parse:function(a){return j.parse(unescape(encodeURIComponent(a)))}},l=d.BufferedBlockAlgorithm=f.extend({reset:function(){this._data=new g.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=k.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(b){var c=this._data,d=c.words,e=c.sigBytes,f=this.blockSize,h=e/(4*f),h=b?a.ceil(h):a.max((0|h)-this._minBufferSize,0);if(b=h*f,e=a.min(4*b,e),b){for(var i=0;i<b;i+=f)this._doProcessBlock(d,i);i=d.splice(0,b),c.sigBytes-=e}return new g.init(i,e)},clone:function(){var a=f.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});d.Hasher=l.extend({cfg:f.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){l.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(b,c){return new a.init(c).finalize(b)}},_createHmacHelper:function(a){return function(b,c){return new m.HMAC.init(a,c).finalize(b)}}});var m=c.algo={};return c}(Math);!function(a){for(var b=FiixCmmsClient_CryptoJS,c=b.lib,d=c.WordArray,e=c.Hasher,c=b.algo,f=[],g=[],h=function(a){return 4294967296*(a-(0|a))|0},i=2,j=0;64>j;){var k;a:{k=i;for(var l=a.sqrt(k),m=2;m<=l;m++)if(!(k%m)){k=!1;break a}k=!0}k&&(8>j&&(f[j]=h(a.pow(i,.5))),g[j]=h(a.pow(i,1/3)),j++),i++}var n=[],c=c.SHA256=e.extend({_doReset:function(){this._hash=new d.init(f.slice(0))},_doProcessBlock:function(a,b){for(var c=this._hash.words,d=c[0],e=c[1],f=c[2],h=c[3],i=c[4],j=c[5],k=c[6],l=c[7],m=0;64>m;m++){if(16>m)n[m]=0|a[b+m];else{var o=n[m-15],p=n[m-2];n[m]=((o<<25|o>>>7)^(o<<14|o>>>18)^o>>>3)+n[m-7]+((p<<15|p>>>17)^(p<<13|p>>>19)^p>>>10)+n[m-16]}o=l+((i<<26|i>>>6)^(i<<21|i>>>11)^(i<<7|i>>>25))+(i&j^~i&k)+g[m]+n[m],p=((d<<30|d>>>2)^(d<<19|d>>>13)^(d<<10|d>>>22))+(d&e^d&f^e&f),l=k,k=j,j=i,i=h+o|0,h=f,f=e,e=d,d=o+p|0}c[0]=c[0]+d|0,c[1]=c[1]+e|0,c[2]=c[2]+f|0,c[3]=c[3]+h|0,c[4]=c[4]+i|0,c[5]=c[5]+j|0,c[6]=c[6]+k|0,c[7]=c[7]+l|0},_doFinalize:function(){var b=this._data,c=b.words,d=8*this._nDataBytes,e=8*b.sigBytes;return c[e>>>5]|=128<<24-e%32,c[(e+64>>>9<<4)+14]=a.floor(d/4294967296),c[(e+64>>>9<<4)+15]=d,b.sigBytes=4*c.length,this._process(),this._hash},clone:function(){var a=e.clone.call(this);return a._hash=this._hash.clone(),a}});b.SHA256=e._createHelper(c),b.HmacSHA256=e._createHmacHelper(c)}(Math),function(){var a=FiixCmmsClient_CryptoJS,b=a.enc.Utf8;a.algo.HMAC=a.lib.Base.extend({init:function(a,c){a=this._hasher=new a.init,"string"==typeof c&&(c=b.parse(c));var d=a.blockSize,e=4*d;c.sigBytes>e&&(c=a.finalize(c)),c.clamp();for(var f=this._oKey=c.clone(),g=this._iKey=c.clone(),h=f.words,i=g.words,j=0;j<d;j++)h[j]^=1549556828,i[j]^=909522486;f.sigBytes=g.sigBytes=e,this.reset()},reset:function(){var a=this._hasher;a.reset(),a.update(this._iKey)},update:function(a){return this._hasher.update(a),this},finalize:function(a){var b=this._hasher;return a=b.finalize(a),b.reset(),b.finalize(this._oKey.clone().concat(a))}})}();var FiixCmmsClient=function(){function a(){"function"==typeof XMLHttpRequest?(ka=!0,la=!1):"object"==typeof XMLHttpRequest?(ka=!0,la=!1):"function"==typeof require&&require&&(ka=!1,la=!0)}function b(){if(null==ba)if(_===aa)ba={major:2,minor:3,patch:1,preRelease:"alpha",metadata:null};else{var a=aa.split("."),b=parseInt(a[0]),c=parseInt(a[1]),d=parseInt(a[2]);ba={major:b,minor:c,patch:d}}return ba}function c(a){ka=a,la=!a}function d(a){ka=!a,la=a}function f(){return ia}function g(a){ia=a}function h(){return ga}function i(a){ga=a}function j(a){ha=a}function k(a){U=a}function l(a){W=a}function m(a){X=a}function n(a){V=a}function o(a){p=a}function p(a){return JSON.parse(a)}function q(){var a=new Date,b=new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),a.getHours(),a.getMinutes(),a.getSeconds(),a.getMilliseconds()));return b.getTime()}function r(a){var b=new Date,c=b.getFullYear().toString(),d=(b.getMonth()+1).toString(),e=b.getDate().toString(),f=c+"-"+(d[1]?d:"0"+d[0])+"-"+(e[1]?e:"0"+e[0]),g=FiixCmmsClient_CryptoJS.SHA256("2EHmD0NNcrcQ"+a+f),i=FiixCmmsClient_CryptoJS.enc.Hex.stringify(g).toLowerCase();return h()+"wo-req-upload/"+a+"?sh="+i}function s(){var a={};return a.endpoint=h(),a.endpoint+="upload",a.queryString="",a.queryString+="action="+encodeURIComponent("upload"),a.queryString+="&service="+encodeURIComponent("cmms"),a.queryString+="&accessKey="+encodeURIComponent(V),a.queryString+="&appKey="+encodeURIComponent(W),a.queryString+="&timestamp="+encodeURIComponent(q()),a.queryString+="&signatureVersion=1",a.queryString+="&signatureMethod=HmacSHA256",a.uri=a.endpoint+"?"+a.queryString,a.headers=[{key:"Content-Type",value:"text/plain"}],ha&&(a.signature=v(a),a.headers.push({key:"Authorization",value:a.signature})),a.endpoint+"?"+a.queryString+"&sig="+a.signature}function t(a){var b={};return b.endpoint=h(),b.endpoint+="download/"+a,b.queryString="",b.queryString+="action="+encodeURIComponent("download"),b.queryString+="&service="+encodeURIComponent("cmms"),b.queryString+="&accessKey="+encodeURIComponent(V),b.queryString+="&appKey="+encodeURIComponent(W),b.queryString+="&timestamp="+encodeURIComponent(q()),b.queryString+="&signatureVersion=1",b.queryString+="&signatureMethod=HmacSHA256",b.uri=b.endpoint+"?"+b.queryString,b.headers=[{key:"Content-Type",value:"text/plain"}],ha&&(b.signature=v(b),b.headers.push({key:"Authorization",value:b.signature})),b.endpoint+"?"+b.queryString+"&sig="+b.signature}function u(a){var b={};return b.endpoint=h(),b.queryString="",b.queryString+="action="+encodeURIComponent(a),b.queryString+="&service="+encodeURIComponent("cmms"),b.queryString+="&accessKey="+encodeURIComponent(V),b.queryString+="&appKey="+encodeURIComponent(W),b.queryString+=X&&X.revision?"&syncRev="+encodeURIComponent(X.revision):"",b.queryString+="&timestamp="+encodeURIComponent(q()),b.queryString+="&signatureVersion=1",b.queryString+="&signatureMethod=HmacSHA256",b.uri=b.endpoint+"?"+b.queryString,b.headers=[{key:"Content-Type",value:"text/plain"}],ha&&(b.signature=v(b),b.headers.push({key:"Authorization",value:b.signature})),b}function v(a){if(!U)throw"Error: you need to provide credentials.";var b=a.uri;0==b.indexOf("http://")?b=b.substring("http://".length):0==b.indexOf("https://")&&(b=b.substring("https://".length));var c=FiixCmmsClient_CryptoJS.HmacSHA256(b,U),d=FiixCmmsClient_CryptoJS.enc.Hex.stringify(c).toLowerCase();return d}function w(a){var b={leg:"CLIENT_REQUEST_SEND_OR_RECEIVE",code:100,message:"Error while parsing the response",stackTrace:a?a.toString():""};return b}function x(a){var b={leg:"CLIENT_REQUEST_SEND_OR_RECEIVE",code:110,message:"Unexpected HTTP status code: "+a,stackTrace:null};return b}function y(a){var b={leg:"CLIENT_REQUEST_SEND_OR_RECEIVE",code:120,message:"Timeout",stackTrace:a?a.toString():""};return b}function z(){var a={leg:"CLIENT_REQUEST_SEND_OR_RECEIVE",code:130,message:"You need to provide a valid baseUri",stackTrace:null};return a}function A(a){var b=h(),c=b.indexOf("://");if(c<0)throw"Invalid URI";a.protocol=b.substring(0,c);var d=b.indexOf("/",c+"://".length),e=b.substring(c+"://".length,d),f=e.indexOf(":");if(f>0){var g=e.substring(0,f);a.hostname=g;var i=e.substring(f+1),j=parseInt(i);a.port=j}else a.hostname=e}function B(a,b,c){try{A(a)}catch(a){var d={};return d.error=z(),b?(b(d),null):d}var d=null,e=new XMLHttpRequest(a,b,c);e.open("POST",a.uri,null!==b);for(var f=0;f<a.headers.length;f++){var g=a.headers[f];e.setRequestHeader(g.key,g.value)}return e.onreadystatechange=function(){if(4==this.readyState){if(d={},200==this.status)try{d=p(this.responseText)}catch(a){d.error=w(a)}else d.error=x(this.status);null!==b&&b(d)}},e.send(c),d}function C(a,c,d){if("function"!=typeof c)throw'You must provide a "callback" method to receive the response.';try{A(a)}catch(a){var g={};return g.error=z(),c?(c(g),null):g}var h=null,i={};i["User-Agent"]="FiixCmmsClient (Node) "+b();for(var j=0;j<a.headers.length;j++){var k=a.headers[j];i[k.key]=k.value}var l={host:a.hostname,port:a.port,method:"POST",headers:i,path:"/api/?"+a.queryString},m="https"==a.protocol,n=m?require("https"):require("http");if(m){var o=require("https"),q=new o.Agent({rejectUnauthorized:!0});l.agent=q}var r="",s=0,t=n.request(l,function(a){a.setEncoding("utf8"),a.on("data",function(a){r+=a,s++}),a.on("end",function(){var a=p(r);c(a)})});return f()&&t.setTimeout(f(),function(){try{stream.abort()}catch(a){}var a={};a.error=y(e),c(a)}),t.on("error",function(a){var b={};b.error=w(a),c(b)}),t.write(d),t.end(),h}function D(a){var c="function"==typeof a[da]?a[da]:null;delete a[da],a.requestId=$,$++,a.requestSentUnixTime=q(),a.clientVersion=b(),"undefined"!=typeof X&&null!=X&&(a.syncRev=X);var d=JSON.stringify(a),e=a[ca],f=u(e),g=null;if(la)g=C(f,c,d);else{if(!ka)throw"Error: unknown environment - not Node, not browser, what is it?";g=B(f,c,d)}if(null===c)return g}function E(a){return a[ca]="FindByIdRequest",a}function F(a){var b=E(a),c=D(b);return c}function G(a){return a[ca]="FindRequest",a}function H(a){var b=G(a),c=D(b);return c}function I(a){a[ca]="AddRequest";var b=a[ea],c=a[fa];return T(b,c),a}function J(a){var b=I(a),c=D(b);return c}function K(a){a[ca]="ChangeRequest",delete a.id;var b=a[ea],c=a[fa];return T(b,c),a}function L(a){var b=K(a),c=D(b);return c}function M(a){return a[ca]="RemoveRequest",a}function N(a){var b=M(a),c=D(b);return c}function O(a){return a[ca]="RpcRequest",a}function P(a){var b=O(a),c=D(b);return c}function Q(a){a[ca]="BatchRequest";var b=D(a);return b}function R(){var a=P({name:"GetPermissions",action:"get"});return!(!a.response||!a.response.object)&&(Y=a.response.object.permissionsDescriptor,void(Z=(new Date).getTime()))}function S(a,b,c){var d="tbl"+a;if((!Y||(new Date).getTime()-Z>ja)&&(R(),!Y))return!1;var e=Y,f=!1;if(e.isAdministrator)f=!0;else for(var g="marn:cmms:tbl:"+d,h=e.resourceIdsByName[g],i="r"+h+".grants=",j=!1,k=0;k<e.groupIdsBySiteId.length&&!j;k++){var l=e.groupIdsBySiteId[k],m=l.siteId;if(null==c||c==m)for(var n=l.groupIds,o=0;o<n.length;o++){var p=n[o],q=e.permissionsByGroupId[p];if(q){var r=q.indexOf(i);if(r>=0){var s=q.indexOf("\n",r);if(s>0){var t=q.substring(r+i.length,s);if(t){var u=t.indexOf(b);if(u>=0){f=!0,j=!0;break}}}}}}}return f}function T(a,b){b[ea]=a}var U,V,W,X,Y,Z,$=0,_="2.5.2",aa=_,ba=null,ca="_maCn",da="callback",ea="className",fa="object",ga="/api/",ha=!0,ia=3e4,ja=6e5,ka=!1,la=!1;a();return{getClientVersion:b,setBaseUri:i,getBaseUri:h,getTimeoutMs:f,setTimeoutMs:g,setUseXhr:c,setUseNode:d,setPKey:k,setAppKey:l,setSyncRev:m,setAuthToken:n,setSignMessages:j,setMaConnectJsonParseFunction:o,prepareFindById:E,findById:F,prepareFind:G,find:H,prepareAdd:I,add:J,prepareChange:K,change:L,prepareRemove:M,remove:N,prepareRpc:O,rpc:P,getSignedRequestParams:u,batch:Q,hasClassPermission:S,calcFileURI:t,calcFileUploadURI:s,calcWOFileURI:r}};"object"==typeof exports&&(module.exports=FiixCmmsClient);